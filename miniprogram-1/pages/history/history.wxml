<!-- pages/history/history.wxml -->
<view class="page">
  <!-- Header -->
  <view class="header">
    <view class="header-left" bindtap="onBack">
      <text class="icon"> </text>
    </view>
    <view class="header-title">å†å²è®°å½•</view>
    <view class="header-right" bindtap="refresh">
      <text class="header-action">åˆ·æ–°</text>
    </view>
  </view>

  <view wx:if="{{loading}}" class="status">åŠ è½½ä¸­â€¦</view>
  <view wx:if="{{error}}" class="status error">é”™è¯¯ï¼š{{error}}</view>

  <view wx:if="{{!loading && !error && items.length === 0}}" class="empty">
    <text class="empty-icon">ğŸ—‚ï¸</text>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
  </view>

  <!-- List -->
  <view class="list" wx:if="{{items.length > 0}}">
    <view
      wx:for="{{items}}"
      wx:key="id"
      class="card"
      bindtap="openReport"
      data-id="{{item.id}}"
    >
      <!-- å³ä¸Šè§’ ... èœå•ï¼šç‹¬ç«‹ï¼Œä¸å‹åˆ†æ•°æ¡† -->
      <view class="more" catchtap="openMore" data-id="{{item.id}}" data-name="{{item.name}}">
        <text class="more-icon">â‹¯</text>
      </view>

      <view class="row">
        <!-- å·¦ä¾§æ–‡å­—åŒº -->
        <view class="left">
          <view class="name">{{item.name}}</view>

          <view class="subrow">
            <text class="subtxt">{{item.dateText}}</text>
            <text class="dot">Â·</text>
            <text class="subtxt">èº«ä»½ï¼š{{item.identityText}}</text>
          </view>

          <!-- åˆåŒåŸæ–‡èŠ‚é€‰ -->
          <view class="snippet-row" catchtap="openSnippet" data-id="{{item.id}}">
            <text class="snippet-label">åˆåŒåŸæ–‡ï¼š</text>
            <text class="snippet-text">{{item.snippetPreview}}</text>
            <text class="snippet-more">æŸ¥çœ‹</text>
          </view>
        </view>

        <!-- å³ä¾§åˆ†æ•°æ¡†ï¼ˆåŒ…å«é£é™©ç­‰çº§ + åˆ†æ•°ï¼‰ -->
        <view class="right">
          <view class="scoreBox {{item.riskClass}}">
            <view class="scoreBoxInner">
              <view class="scoreRisk">{{item.riskText}}</view>
              <view class="scoreNum">{{item.score}}</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- âœ… åˆåŒåŸæ–‡èŠ‚é€‰å¼¹çª— -->
  <view wx:if="{{snippetOpen}}" class="modal-mask" catchtap="closeSnippet">
    <view class="modal" catchtap="noop">
      <view class="modal-head">
        <view class="modal-title">åˆåŒåŸæ–‡èŠ‚é€‰</view>
        <view class="modal-close" catchtap="closeSnippet">âœ•</view>
      </view>

      <view class="modal-sub">
        <text class="modal-name">{{snippetTitle}}</text>
        <text class="modal-meta">{{snippetMeta}}</text>
      </view>

      <scroll-view scroll-y="true" class="modal-body">
        <text class="modal-text">{{snippetText}}</text>
      </scroll-view>

      <view class="modal-foot">
        <button class="modal-btn" bindtap="closeSnippet">å…³é—­</button>
      </view>
    </view>
  </view>
</view>

